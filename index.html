<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CYBER_PROFILE.exe | System Access</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --neon-blue: #00f3ff;
            --neon-pink: #bc13fe;
            --neon-green: #00ff9d;
            --bg-dark: #050505;
        }

        * { 
            margin: 0; 
            padding: 0; 
            box-sizing: border-box; 
        }
        
        body {
            font-family: 'Courier New', monospace;
            background: var(--bg-dark);
            color: var(--neon-blue);
            height: 100vh;
            overflow: hidden;
            display: flex;
            flex-direction: column;
            align-items: center;
            position: relative;
        }

        /* --- BACKGROUND LAYERS --- */
        #matrixRain, .cyber-grid {
            position: fixed; 
            top: 0; 
            left: 0; 
            width: 100%; 
            height: 100%; 
            pointer-events: none;
        }
        .matrix-rain { 
            z-index: 1; 
            opacity: 0.25; 
        }
        .cyber-grid {
            background: 
                linear-gradient(90deg, rgba(188, 19, 254, 0.05) 1px, transparent 1px),
                linear-gradient(180deg, rgba(0, 243, 255, 0.05) 1px, transparent 1px);
            background-size: 50px 50px;
            z-index: 2;
        }

        /* --- START SCREEN --- */
        #start-screen {
            position: fixed; 
            top: 0; 
            left: 0; 
            width: 100%; 
            height: 100%;
            background: #000; 
            z-index: 9999;
            display: flex; 
            flex-direction: column; 
            justify-content: center; 
            align-items: center;
            cursor: pointer; 
            transition: opacity 0.8s ease;
        }
        .start-btn {
            border: 2px solid var(--neon-pink); 
            padding: 20px 40px;
            font-size: 1.5rem; 
            color: var(--neon-blue); 
            letter-spacing: 4px;
            text-shadow: 0 0 10px var(--neon-blue);
            box-shadow: 0 0 20px rgba(188, 19, 254, 0.4);
            animation: pulseText 2s infinite;
        }
        @keyframes pulseText {
            0%, 100% { opacity: 0.8; }
            50% { opacity: 1; }
        }
        .start-sub { 
            margin-top: 15px; 
            color: var(--neon-pink); 
            font-size: 0.8rem; 
            opacity: 0.8; 
        }

        /* --- MAIN LAYOUT --- */
        .container {
            width: 100%; 
            height: 100%;
            display: flex; 
            flex-direction: column; 
            align-items: center;
            z-index: 10; 
            position: relative;
        }
        
        /* PROFILE SECTION */
        .profile-section {
            text-align: center; 
            padding: 0 0px; 
            width: 100%; 
            max-width: 800px;
            opacity: 0; 
            transform: translateY(-50px);
            /* UPDATED: 5s */
            transition: all 5s cubic-bezier(0.22, 1, 0.36, 1);
            position: relative; 
            z-index: 20; 
            margin-top: 5vh; 
        }
        .profile-section.visible { 
            opacity: 1; 
            transform: translateY(0); 
        }

        /* PROFILE VISUALIZER/IMAGE WRAPPER */
        .profile-wrapper {
            position: relative;
            width: 200px;  
            height: 200px; 
            margin: 0 auto 5px auto;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .profile-pic {
            width: 100px;  
            height: 100px; 
            border-radius: 50%; 
            object-fit: cover;
            border: 2px solid var(--neon-blue);
            box-shadow: 0 0 15px var(--neon-blue), inset 0 0 10px var(--neon-pink);
            z-index: 22; 
            position: relative;
        }

        #profileVisualizer {
            position: absolute;
            top: 0; 
            left: 0;
            width: 100%; 
            height: 100%;
            z-index: 21; 
            pointer-events: none;
        }

        /* FONT SIZES */
        
        /* Wrapper for Name and Badge */
        .name-wrapper {
            display: flex; /* Aligns the name and badge side-by-side */
            justify-content: center;
            align-items: center;
            margin-bottom: 5px; /* Add some space below the name block */
        }
        
        /* NEW: Image-based Verified Badge Styling */
        .verified-img { 
            width: 25px; /* Set a specific size */
            height: 25px;
            margin-left: 10px;
            /* Apply a subtle glow to the image itself */
            filter: drop-shadow(0 0 3px var(--neon-blue));
            /* Ensure alignment with text base line */
            vertical-align: middle; 
            margin-top: -5px; /* Minor adjustment for perfect center alignment */
        }

        .name { 
            font-size: 1.7rem;
            margin-bottom: 0px; 
            color: #fff; 
            text-shadow: 2px 2px 0 var(--neon-pink), -2px -2px 0 var(--neon-blue); 
            font-weight: 700; 
        }

        .title { 
            font-size: 0.9rem; 
            margin-bottom: 5px;
            color: var(--neon-blue); 
            text-shadow: 0 0 8px var(--neon-blue); 
        }
        .description { 
            line-height: 1.5; 
            font-size: 0.8rem; 
            color: #e0e0e0; 
            text-shadow: 0 0 2px var(--neon-pink); 
            margin-top: 0px;
        }

        /* --- MAIN BOTTOM VISUALIZER --- */
        #visualizer-container {
            position: fixed; 
            top: 60%; 
            left: 0; 
            width: 100%; 
            height: 400px;
            transform: translateY(-50%); 
            z-index: 5; 
            pointer-events: none;
            display: flex; 
            justify-content: center;
        }
        #visualizer { 
            width: 100%; 
            height: 100%; 
        }

        /* --- UI ELEMENTS (Floating Buttons) --- */
        
        /* 1. More About Me Button (Top Left) */
        .more-btn {
            position: fixed; 
            top: 30px; 
            left: 30px; 
            z-index: 200;
            background: rgba(0,0,0,0.6); 
            border: 1px solid var(--neon-blue); 
            border-radius: 50%;
            width: 50px; 
            height: 50px; 
            color: var(--neon-blue); 
            font-size: 1.2rem;
            text-decoration: none;
            cursor: pointer; 
            /* UPDATED: 2s */
            transition: all 2s ease; 
            display: flex; 
            justify-content: center; 
            align-items: center;
            opacity: 0; 
            transform: translateY(-20px);
        }
        .more-btn.visible { 
            opacity: 1; 
            transform: translateY(0); 
        }
        .more-btn:hover { 
            color: var(--neon-pink); 
            border-color: var(--neon-pink); 
            box-shadow: 0 0 20px var(--neon-pink); 
            transform: scale(1.1);
        }

        /* 2. Playlist Container (Bottom Left) */
        .playlist-container {
            position: fixed; 
            left: 30px; 
            bottom: 120px; 
            width: 250px; 
            max-height: 200px;
            background: rgba(0, 0, 0, 0.7);
            border: 1px solid var(--neon-blue);
            border-left: 4px solid var(--neon-pink);
            overflow-y: auto;
            z-index: 200;
            padding: 10px;
            backdrop-filter: blur(5px);
            font-size: 0.8rem;
            display: none; 
            opacity: 0; 
            transform: translateY(50px);
            /* UPDATED: 3.5s */
            transition: all 3.5s ease 0.2s;
        }
        .playlist-container.visible { 
            display: block; 
            opacity: 1; 
            transform: translateY(0); 
        }
        
        .playlist-header {
            color: var(--neon-pink); 
            font-weight: bold; 
            border-bottom: 1px solid var(--neon-blue);
            padding-bottom: 5px; 
            margin-bottom: 5px; 
            letter-spacing: 1px;
        }
        .playlist-item {
            padding: 8px; 
            cursor: pointer; 
            color: #aaa; 
            transition: 0.3s;
            border-bottom: 1px solid rgba(0, 243, 255, 0.1);
            white-space: nowrap; 
            overflow: hidden; 
            text-overflow: ellipsis;
        }
        .playlist-item:hover { 
            color: #fff; 
            background: rgba(188, 19, 254, 0.2); 
        }
        .playlist-item.active {
            color: var(--neon-blue); 
            text-shadow: 0 0 5px var(--neon-blue);
            background: rgba(0, 243, 255, 0.1); 
            border-left: 2px solid var(--neon-blue);
        }

        /* --- MUSIC PLAYER BAR --- */
        .music-section {
            position: fixed; 
            bottom: 50px; 
            left: 0; 
            right: 0;
            display: flex; 
            flex-direction: column; 
            align-items: center;
            z-index: 100; 
            background: linear-gradient(to top, rgba(0,0,0,1), transparent);
            padding-bottom: 10px; 
            pointer-events: none;
            opacity: 0; 
            transform: translateY(50px); 
            /* UPDATED: 3.5s */
            transition: all 3.5s ease;
        }
        .music-section.visible { 
            opacity: 1; 
            transform: translateY(0); 
            pointer-events: auto; 
        }
        
        .now-playing { 
            margin-bottom: 5px; 
            text-align: center; 
        }
        .song-title { 
            font-size: 0.9rem; 
            font-weight: 600; 
            color: var(--neon-blue); 
            text-shadow: 0 0 5px var(--neon-blue); 
        }
        
        .progress-area { 
            width: 300px; 
            display: flex; 
            align-items: center; 
            gap: 10px; 
            margin-bottom: 10px; 
            font-size: 0.75rem; 
            color: var(--neon-pink); 
        }
        .progress-bar { 
            flex-grow: 1; 
            height: 4px; 
            -webkit-appearance: none; 
            background: rgba(255,255,255,0.1); 
            cursor: pointer; 
        }
        .progress-bar::-webkit-slider-thumb { 
            -webkit-appearance: none; 
            width: 12px; 
            height: 12px; 
            background: var(--neon-blue); 
            border-radius: 50%; 
            margin-top: -4px; 
        }
        .progress-bar::-webkit-slider-runnable-track { 
            height: 4px; 
            background: linear-gradient(90deg, var(--neon-pink), var(--neon-blue)); 
        }

        /* --- CONTROLS LAYOUT FIX (GRID SYSTEM) --- */
        .controls-wrapper {
            display: grid;
            grid-template-columns: 1fr auto 1fr;
            width: 300px;
            align-items: center;
        }

        .left-controls {
            justify-self: start;
        }

        .center-controls {
            display: flex;
            gap: 20px;
            justify-content: center;
        }
        
        .right-controls {
            justify-self: end;
        }

        .control-btn { 
            background: transparent; 
            border: none; 
            color: #fff; 
            font-size: 1.2rem; 
            cursor: pointer; 
            transition: 0.3s; 
            text-shadow: 0 0 5px #fff; 
        }
        .control-btn:hover { 
            color: var(--neon-pink); 
            transform: scale(1.1); 
            text-shadow: 0 0 15px var(--neon-pink); 
        }
        .control-btn.active { 
            color: var(--neon-blue); 
            text-shadow: 0 0 15px var(--neon-blue); 
        } 
        
        #playPauseBtn { 
            font-size: 1.8rem; 
            color: var(--neon-blue); 
        }
        
        footer { 
            position: fixed; 
            bottom: 15px; 
            left: 0; 
            width: 100%; 
            text-align: center; 
            z-index: 10; 
            font-size: 0.75rem; 
            color: var(--neon-pink); 
            opacity: 0.8; 
        }

        @media (max-width: 600px) {
            .profile-section { 
                margin-top: 5vh; 
            }
            .playlist-container { 
                bottom: 160px; 
                left: 10px; 
                width: 200px; 
            }
            .name { 
                font-size: 1.5rem; 
            }
            .profile-wrapper { 
                width: 180px; 
                height: 180px; 
            }
            .profile-pic { 
                width: 90px; 
                height: 90px; 
            }
            .progress-area, .controls-wrapper { 
                width: 85vw; 
            }
        }
    </style>
</head>
<body>

    <div id="start-screen">
        <div class="start-btn">INITIALIZE SYSTEM</div>
        <div class="start-sub">[ CLICK ANYWHERE TO ACCESS ]</div>
    </div>

    <canvas class="matrix-rain" id="matrixRain"></canvas>
    <div class="cyber-grid"></div>
    
    <div id="visualizer-container">
        <canvas id="visualizer"></canvas>
    </div>

    <a href="#" class="more-btn" id="moreBtn" title="More About Me">
        <i class="fas fa-user-astronaut"></i>
    </a>

    <div class="container">
        <div class="profile-section" id="profileSection">
            
            <div class="profile-wrapper">
                <canvas id="profileVisualizer"></canvas>
                <img src="https://scontent.fmnl25-4.fna.fbcdn.net/v/t39.30808-6/557621090_1879534862913058_3142175480419287811_n.jpg?_nc_cat=107&ccb=1-7&_nc_sid=6ee11a&_nc_eui2=AeE4I9J7YVH8UR6ynOZUdru-o3T0CuqLmL6jdPQK6ouYvhtSQ5Jn9rwIH1lhXpCdX8M8JtRJ15QB-6m_J9COJrGu&_nc_ohc=JpDWV1GLVVMQ7kNvwH_y1LB&_nc_oc=AdnMHr5owaVLSyIAoBU6fSDwycpOEkT7JoK_zidvnOiyujaFBIT1cTYSP4RgrlfXTYE&_nc_zt=23&_nc_ht=scontent.fmnl25-4.fna&_nc_gid=uS-Cbbj9_G2IeOqPMRfmeQ&oh=00_AfgYd7Jkhj9Lk1ze1BpYO9x0_S2K7jgQPrABUsQFRXdp0w&oe=692C5323" alt="Profile" class="profile-pic">
            </div>
            
            <div class="name-wrapper">
                <h1 class="name">ANDREW SANTIAGO</h1>
                <img src="verified_badge.png" alt="Verified Badge" class="verified-img">
            </div>
            
            <p class="title">> SOFTWARE DEVELOPER, MUSICIAN, COMPUTER ENGINEER</p>
            
            <p class="description">
                > SYSTEM STATUS: ONLINE<br>
                > MISSION: BUILDING THE FUTURE<br>
                > BASED AT ANTIPOLO, RIZAL
            </p>
        </div>
    </div>
    
    <div class="playlist-container" id="playlistContainer">
        <div class="playlist-header">> PLAY_QUEUE</div>
        <div id="playlistItems"></div>
    </div>

    <div class="music-section" id="musicSection">
        <div class="now-playing">
            <div class="song-title" id="nowPlayingTitle">SYSTEM_AUDIO_INITIALIZING...</div>
        </div>
        
        <div class="progress-area">
            <span id="currTime">0:00</span>
            <input type="range" min="0" max="100" value="0" class="progress-bar" id="seekSlider">
            <span id="totalDur">0:00</span>
        </div>

        <div class="controls-wrapper">
            <div class="left-controls">
                <button class="control-btn" id="loopBtn" title="Toggle Loop"><i class="fas fa-repeat"></i></button>
            </div>

            <div class="center-controls">
                <button class="control-btn" id="prevBtn"><i class="fas fa-step-backward"></i></button>
                <button class="control-btn" id="playPauseBtn"><i class="fas fa-play"></i></button>
                <button class="control-btn" id="nextBtn"><i class="fas fa-step-forward"></i></button>
            </div>

            <div class="right-controls"></div>
        </div>
    </div>

    <footer>
        &copy; 2024 CYBER_SYSTEMS | ACCESS_GRANTED
    </footer>

    <script>
        // --- DATA & STATE ---
        let playlist = [
            {
                name: "NIGHTCORE - ROCKEFELLER_STREET.mp3",
                url: 'https://raw.githubusercontent.com/saltysweeteasy/my-music/main/Nightcore%20-%20Rockefeller%20Street%20%5BhenzKOC78nw%5D.mp3',
                type: 'url'
            },
            {
                name: "CRAZIER.mp3",
                url: 'https://raw.githubusercontent.com/saltysweeteasy/my-music/main/Crazier%20(Taylor%20Swift)%20cover%20by%20Arthur%20Miguel%20%5BJuVrOBI--_g%5D.mp3',
                type: 'url'
            },
            {
                name: "PANGARAP LANG KITA",
                url: 'https://raw.githubusercontent.com/saltysweeteasy/my-music/main/www.cabinet-avocat-cadet.fr%20-%20PANGARAP%20LANG%20KITA%20-%20Parokya%20Ni%20Edgar%20feat,%20Happy%20Sy%20(lyrics)%20(320%20KBps).mp3',
                type: 'url'
            }
        ];
        let currentTrackIndex = 0;
        let isLooping = false;
        // pendingTrackName variable removed
        
        // --- MATRIX RAIN ---
        const matrixCanvas = document.getElementById('matrixRain');
        const mCtx = matrixCanvas.getContext('2d');
        function resizeMatrix() { 
            matrixCanvas.width = window.innerWidth; 
            matrixCanvas.height = window.innerHeight; 
        }
        window.addEventListener('resize', resizeMatrix); 
        resizeMatrix();
        
        const chars = "01XYZΩΣΠ"; 
        const drops = [];
        function initMatrix() { 
            for(let i=0; i<matrixCanvas.width/14; i++) drops[i] = 1; 
        }
        
        function drawMatrix() {
            mCtx.fillStyle = "rgba(5, 5, 5, 0.05)"; 
            mCtx.fillRect(0, 0, matrixCanvas.width, matrixCanvas.height);
            mCtx.font = "14px monospace";
            for(let i=0; i<drops.length; i++) {
                mCtx.fillStyle = (Math.random() > 0.5) ? "#00f3ff" : "#bc13fe";
                mCtx.fillText(chars.charAt(Math.floor(Math.random()*chars.length)), i*14, drops[i]*14);
                if(drops[i]*14 > matrixCanvas.height && Math.random() > 0.975) drops[i] = 0; 
                drops[i]++;
            }
        }

        // --- AUDIO SYSTEM ---
        const audio = new Audio(); 
        audio.crossOrigin = "anonymous";
        let audioCtx, analyser, source;
        let mainGradient; 

        // UI Elements
        const playPauseBtn = document.getElementById('playPauseBtn');
        const loopBtn = document.getElementById('loopBtn');
        const prevBtn = document.getElementById('prevBtn');
        const nextBtn = document.getElementById('nextBtn');
        const nowPlayingTitle = document.getElementById('nowPlayingTitle');
        const seekSlider = document.getElementById('seekSlider');
        const currTime = document.getElementById('currTime');
        const totalDur = document.getElementById('totalDur');
        const playlistContainer = document.getElementById('playlistContainer');
        const playlistItemsDiv = document.getElementById('playlistItems');
        // fileUpload variable removed

        // Visualizer Canvases
        const visualCanvas = document.getElementById('visualizer');
        const vCtx = visualCanvas.getContext('2d');
        const profileCanvas = document.getElementById('profileVisualizer');
        const pCtx = profileCanvas.getContext('2d');

        // --- UPLOAD FUNCTIONALITY REMOVED ---
        // uploadBtn and fileUpload event handlers removed.
        // loadLocalTracks and saveLocalTracks functions removed.

        // --- INITIALIZATION ---
        document.getElementById('start-screen').addEventListener('click', function() {
            this.style.opacity = '0'; 
            setTimeout(() => this.remove(), 800);
            
            initMatrix(); 
            setInterval(drawMatrix, 50);
            setupAudioContext();
            
            // Trigger Animations
            document.getElementById('profileSection').classList.add('visible');
            document.getElementById('musicSection').classList.add('visible');
            document.getElementById('moreBtn').classList.add('visible');
            // document.getElementById('uploadContainer').classList.add('visible'); line removed
            playlistContainer.classList.add('visible');
            
            // Load playlist
            // loadLocalTracks() removed
            renderPlaylist();
            currentTrackIndex = 0;
            loadTrack(0);
            
            // Auto-play after a delay
            setTimeout(() => {
                playAudio();
            }, 1500);
        });

        function createMainGradient() {
            mainGradient = vCtx.createLinearGradient(0, 0, visualCanvas.width, 0);
            mainGradient.addColorStop(0.0, '#00f3ff'); 
            mainGradient.addColorStop(0.2, '#bc13fe'); 
            mainGradient.addColorStop(0.4, '#ff0055'); 
            mainGradient.addColorStop(0.6, '#ff9900'); 
            mainGradient.addColorStop(0.8, '#ffff00'); 
            mainGradient.addColorStop(1.0, '#00ff99'); 
        }

        function setupAudioContext() {
            if(!audioCtx) {
                audioCtx = new (window.AudioContext || window.webkitAudioContext)();
                analyser = audioCtx.createAnalyser();
                source = audioCtx.createMediaElementSource(audio);
                source.connect(analyser);
                analyser.connect(audioCtx.destination);
                analyser.fftSize = 512; 
                analyser.smoothingTimeConstant = 0.8;
                
                resizeVisualizers();
                createMainGradient(); 
                requestAnimationFrame(drawMainVisualizer);
                requestAnimationFrame(drawProfileVisualizer);
            } else if(audioCtx.state === 'suspended') audioCtx.resume();
        }

        function resizeVisualizers() {
            visualCanvas.width = visualCanvas.offsetWidth; 
            visualCanvas.height = visualCanvas.offsetHeight;
            profileCanvas.width = profileCanvas.offsetWidth; 
            profileCanvas.height = profileCanvas.offsetHeight;
            if(audioCtx) createMainGradient(); 
        }
        window.addEventListener('resize', resizeVisualizers);

        // --- PLAYLIST LOGIC ---
        function renderPlaylist() {
            playlistItemsDiv.innerHTML = "";
            playlist.forEach((track, index) => {
                const div = document.createElement('div');
                div.className = `playlist-item ${index === currentTrackIndex ? 'active' : ''}`;
                // localIndicator logic removed
                div.textContent = `${index + 1}. ${track.name.replace('.mp3', '')}`; 
                div.onclick = () => { 
                    currentTrackIndex = index; 
                    loadTrack(index); 
                    playAudio(); 
                };
                playlistItemsDiv.appendChild(div);
            });
        }

        function loadTrack(index) {
            if(index < 0 || index >= playlist.length) return;
            const track = playlist[index];
            
            // 1. Define the error handler to try skipping
            // This catches severe errors (like file not found or corrupted file)
            audio.onerror = function(e) {
                console.error(`Playback Error on ${track.name}:`, e.target.error.code, e.target.error.message);
                nowPlayingTitle.textContent = `ERROR: Cannot load ${track.name}`;
                
                // Only try to skip if this is still the current track
                if (currentTrackIndex === index) { 
                    setTimeout(() => {
                        console.log("Skipping to next track due to error.");
                        currentTrackIndex = (currentTrackIndex + 1) % playlist.length;
                        loadTrack(currentTrackIndex); 
                        playAudio();
                    }, 2000);
                }
            };
            
            audio.onloadstart = function() {
                nowPlayingTitle.textContent = `LOADING: ${track.name}`;
            };
            
            // 2. CRITICAL FIX: Clear the error handler once the track is ready to play.
            // This prevents spurious skips if the browser registers a successful load.
            audio.oncanplay = function() {
                console.log(`Track loaded successfully: ${track.name}`);
                audio.onerror = null; // Clear handler on successful load/canplay
                // We don't call playAudio here, it's called after loadTrack()
            };

            audio.src = track.url;
            renderPlaylist();
            
            // Preload the audio
            audio.load();
        }

        function playAudio() {
            audio.play().then(() => {
                playPauseBtn.innerHTML = '<i class="fas fa-pause"></i>';
                nowPlayingTitle.textContent = playlist[currentTrackIndex].name;
                if(audioCtx?.state === 'suspended') audioCtx.resume();
            }).catch(e => {
                console.log("Playback error", e);
                // If autoplay is blocked, show play button and message
                playPauseBtn.innerHTML = '<i class="fas fa-play"></i>';
                nowPlayingTitle.textContent = `CLICK PLAY: ${playlist[currentTrackIndex].name}`;
            });
        }

        // --- CONTROLS ---
        playPauseBtn.onclick = () => {
            if(audio.paused) {
                playAudio();
            } else { 
                audio.pause(); 
                playPauseBtn.innerHTML = '<i class="fas fa-play"></i>'; 
            }
        };

        loopBtn.onclick = () => {
            isLooping = !isLooping;
            loopBtn.classList.toggle('active');
            loopBtn.innerHTML = isLooping ? '<i class="fas fa-repeat"></i> 1' : '<i class="fas fa-repeat"></i>';
        };

        nextBtn.onclick = () => {
            currentTrackIndex = (currentTrackIndex + 1) % playlist.length;
            loadTrack(currentTrackIndex); 
            playAudio();
        };

        prevBtn.onclick = () => {
            currentTrackIndex = (currentTrackIndex - 1 + playlist.length) % playlist.length;
            loadTrack(currentTrackIndex); 
            playAudio();
        };

        // Auto Next / Loop Logic
        audio.onended = () => {
            if(isLooping) {
                audio.currentTime = 0; 
                playAudio();
            } else {
                nextBtn.click();
            }
        };

        // --- DRAWING FUNCTIONS ---
        function drawMainVisualizer() {
            requestAnimationFrame(drawMainVisualizer);
            if (!analyser) return;

            const bufferLength = analyser.frequencyBinCount;
            const dataArray = new Uint8Array(bufferLength);
            analyser.getByteFrequencyData(dataArray);
            
            vCtx.clearRect(0, 0, visualCanvas.width, visualCanvas.height);
            vCtx.fillStyle = mainGradient; 

            const bars = 200; 
            const barW = visualCanvas.width / bars;
            const centerY = visualCanvas.height / 2;
            const maxH = visualCanvas.height / 2;

            let sum = 0;
            for(let i = 0; i < dataArray.length; i++) { sum += dataArray[i]; }
            const averageVolume = sum / dataArray.length; 
            
            const rawVolumeEffect = (averageVolume / 255) * maxH * 1.5;
            const volumeEffect = rawVolumeEffect > 30 ? rawVolumeEffect * 0.2 : rawVolumeEffect;
            const baseHeight = 5;

            for(let i=0; i<bars; i++) {
                const wave = Math.sin(i * 0.2 + Date.now()/200) * 10; 
                let h = baseHeight + volumeEffect + wave; 
                h = Math.max(5, Math.min(h, maxH - 2)); 

                vCtx.beginPath();
                vCtx.roundRect(i * barW, centerY - h, barW - 2, h, 4);
                vCtx.roundRect(i * barW, centerY, barW - 2, h, 4);
                vCtx.fill();
            }
        }

        function drawProfileVisualizer() {
            requestAnimationFrame(drawProfileVisualizer);
            if (!analyser) return;
            
            const bufferLength = analyser.frequencyBinCount;
            const dataArray = new Uint8Array(bufferLength);
            analyser.getByteFrequencyData(dataArray);

            pCtx.clearRect(0, 0, profileCanvas.width, profileCanvas.height);

            const cx = profileCanvas.width / 2;
            const cy = profileCanvas.height / 2;
            
            const radius = 55; 
            const bars = 60;
            const step = (Math.PI * 2) / bars;
            const time = Date.now() / 300;

            let sum = 0;
            for(let i = 0; i < dataArray.length; i++) { sum += dataArray[i]; }
            const averageVolume = sum / dataArray.length; 

            const baseBarLength = 10; 
            const volumeEffect = (averageVolume / 255) * 15; 

            for(let i=0; i<bars; i++) {
                const wave = Math.sin(i * 0.5 + time) * 5; 
                let barLen = baseBarLength + volumeEffect + wave; 
                barLen = Math.max(5, Math.min(barLen, 40)); 

                pCtx.strokeStyle = `hsl(${i * 5 + time * 50}, 100%, 50%)`;
                pCtx.lineWidth = 3;
                pCtx.lineCap = 'round';

                pCtx.save();
                pCtx.translate(cx, cy);
                pCtx.rotate(i * step);
                
                pCtx.beginPath();
                pCtx.moveTo(0, radius);
                pCtx.lineTo(0, radius + barLen);
                pCtx.stroke();
                
                pCtx.restore();
            }
        }

        // Seek Bar
        audio.ontimeupdate = () => {
            seekSlider.value = (audio.currentTime / audio.duration) * 100 || 0;
            currTime.textContent = fmtTime(audio.currentTime);
            totalDur.textContent = fmtTime(audio.duration || 0);
        };
        seekSlider.oninput = (e) => audio.currentTime = (e.target.value / 100) * audio.duration;
        function fmtTime(s) { 
            const minutes = Math.floor(s / 60);
            const seconds = Math.floor(s % 60);
            return `${minutes}:${seconds < 10 ? '0' : ''}${seconds}`;
        }

    </script>
</body>
</html>